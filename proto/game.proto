syntax = "proto3";

package game;

// things we thought about

message ViewAngle {
  float pitch = 1;
  float yaw = 2;
  float roll = 3;
}
message C2S_PlayerMoveCommand {
  optional int32 command_number = 1; // this is just for sequencing!
  optional int32 tick_count = 2;
  
  // View Angles (High precision)
  optional ViewAngle viewangles = 3; 

  // Movement (Forward/Side/Up)
  optional float forwardmove = 4;
  optional float sidemove = 5;
  optional float upmove = 6;

  // The "Buttons" Bitfield
  optional uint64 buttons_bitfield = 7; 
}
// FOR NOW, ASSUME IS_DELTA IS ALWAYS TRUE!
// s2c is server to client.
message S2C_EntityPackage {
    optional int32 expected_max_entities = 1;
    optional bool is_delta = 2;
    optional int32 update_baseline = 3;
    optional bytes entity_data = 4; // this is the reflective snapshot data
} 

// --------------------------------------------- things that are uncertain


message Player {
  string name = 1;
  int32 id = 2;
  float score = 3;
}

message Vec3 {
  float x = 1;
  float y = 2;
  float z = 3;
}

enum EntityType {
  UNKNOWN = 0;
  PLAYER = 1;
  WEAPON = 2;
}

message CmdSpawn {
  int32 entity_id = 1;
  int32 type_id = 2;
  Vec3 position = 3;
}



message CmdMove {
  int32 entity_id = 1;
  Vec3 target_position = 2;
}

message GameTick {
  uint32 tick_id = 1;
  repeated CmdSpawn spawns = 2;
  repeated CmdMove moves = 3;
}

message Replay {
  string server_name = 1;
  int64 timestamp = 2;
  repeated GameTick ticks = 3;
  uint64 seed = 4;
}

message EntityState {
  uint64 entity_id = 1;
  Vec3 position = 2;
  Vec3 velocity = 3;
  // Add other components here as optional fields
}

message Snapshot {
  uint32 tick_id = 1;
  uint32 delta_from_tick_id = 2; // 0 = Full Snapshot
  repeated EntityState entities = 3;
  uint64 rng_state = 4;
}

message AABB {
  Vec3 center = 1;
  Vec3 half_extents = 2;
}

message EntitySpawn {
  EntityType type = 1;
  Vec3 position = 2;
  float yaw = 3;
}

message MapSource {
  repeated AABB aabbs = 1;
  string name = 2;
  repeated EntitySpawn entities = 3;
}

// --------------------------------------------- Network Negotiation

message CmdConnect {
    int32 protocol_version = 1;
    string player_name = 2;
}

message CmdAccept {
    int32 client_slot = 1;
    string map_name = 2;       // The map the server is currently running
    int32 server_tickrate = 3;
}

message CmdReject {
    string reason = 1;
}

message CmdDisconnect {
    string reason = 1;
}

message NetCommand {
    // Oneof ensures only one payload is set
    oneof command {
        CmdConnect connect = 2;
        CmdAccept accept = 3;
        CmdReject reject = 4;
        CmdDisconnect disconnect = 5;
    }
}
